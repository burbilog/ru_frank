# Скрипт подготовки японского текста для чтения по методу Ильи Франка для LibreOffice

## Работа с LLM

### Выбор LLM

TODO: описать требования к LLM, сказать что DeepSeek R1 вполне справляется

### Порядок работы

Взять промпт в PROMPT.txt, к нему надо приклеить исходный текст и дать современной
модели, такой как Sonnet 4, ChatGPT O3, Gemini 2.5 Pro, DeepSeek R1 (нажать 
перед отправкой переключатель DeepSeek (R1) ниже поля ввода в интерфейсе DeepSeek).

Полученный текст обработать в LibreOffice и напечатать или читать так.

## Работа с LibreOffice

### Установка (linux)

sudo apt install libreoffice-script-provider-python
mkdir -p ~rm/.config/libreoffice/4/user/Scripts/python

…/user/Scripts/python – именно её LibreOffice показывает как
cp ~/.config/libreoffice/4/user/Scripts/python/furigana_convert.py

После этого у вас появится иерархия

~~~
Copy
My Macros
  └── user
        └── <ваши .py файлы>
~~~

После установки перезапустите LibreOffice → в меню появится «Python…», и макрос станет применим.
LibreOffice «сканирует» скрипты только при старте программы (или при явном вызове меню). Без перезапуска новые файлы не видны.

Добавляем кнопку «Фуригана» в панель Writer
LibreOffice умеет запускать любые макросы (Python, Basic, JavaScript) через элементы интерфейса.
Процедура полностью графическая — ничего программировать не нужно.

Шаг-за-шагом
Откройте Writer.
(Документ может быть пустым — главное, чтобы был активен модуль Writer.)

Меню Tools → Customize…
Появится диалог «Customize».

Вкладка Toolbars.
• В поле Toolbar выберите, куда вставлять кнопку.

Standard (стандартная панель)
Formatting, Table …
или нажмите New…, чтобы сделать собственную панель «Furigana».
• Нажмите Add….
Диалог «Add Commands».

В списке Category щёлкните Macros.
В правом списке найдите
My Macros → user → furigana_convert.py → furigana_convert.
Выделите функцию, нажмите Add.
Закройте окно Add Commands.
При желании меняем внешний вид.
В диалоге Customize команду уже видно в списке кнопок.
• Выделите её → Modify.

Rename… — задайте подпись, например Фуригана.
Change Icon… — выберите стандартный значок или нажмите Import… и добавьте свой PNG-икон (16×16 px; прозрачный).
Text only / Icon and text — как отображать на панели.
Нажмите OK.
Диалог закроется, а на выбранной панели появится новая кнопка.

Проверьте.
Выделите или введите в документе строку вида 日本語（にほんご）, нажмите свою кнопку — текст превратится в кандзи с фуриганой.

Потом результат работы LLM вставляем в текст, нажимаем на кнопку и получаем реузльтат.


### Горячая клавиша (по желанию)
В том же диалоге Tools → Customize, вкладка Keyboard:

В поле Shortcut Keys выберите свободное сочетание, например Ctrl+Shift+J.
Внизу, в Category = Macros → My Macros → user → furigana_convert.py.
Выделите furigana_convert и нажмите Modify.
ОК.
Теперь макрос выполняется как кнопкой, так и горячей клавишей.

### Если нужно перенести на другой компьютер

Скопируйте файл furigana_convert.py в тот же каталог
…/user/Scripts/python/ на новой системе.
Повторите только пункт «Добавляем кнопку».
(Настройка панелей хранится в профиле пользователя, а не в самом скрипте.)

### FAQ

1.  Почему в списке «Category» не видно «Macros»

Диалог Add Commands действительно содержит пункт
LibreOffice Macros → My Macros → …, но:

он располагается самым нижним в алфавитном списке Category;
при узком окне его легко «проскроллить» и не заметить;
если окно Add Commands не раскрыто достаточно высоко, LibreOffice не
показывает «дерево» (видны только пункты Insert, Format, Run Macro).
Ниже — способ гарантированно добавить кнопку, плюс альтернативный вариант через «URL-вызов» макроса, если пункт всё-таки не появляется.

2. DeepSeek плохо понимает где есть абзац, где нет.

Увы, все что можно сделать это вручную добавить еще одну строку между абзацами, тогда он четко поймет разделение.
